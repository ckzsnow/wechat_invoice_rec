<!DOCTYPE html>
<html>
	<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="renderer" content="webkit">
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
	<title>帮帮账智能票据</title>
	<link href="/img/favicon.png" rel="Shortcut Icon">
	<link rel="stylesheet" type="text/css" href="/css/base_list.css"/>
	<link rel="stylesheet" type="text/css" href="/css/list.css"/>
	<link rel="stylesheet" type="text/css" href="/css/user.css"/>
	<link rel="stylesheet" type="text/css" href="/css/pagnav.css"/>
	<link rel="stylesheet" type="text/css" href="/css/manage.css"/>
	<link type="text/css" href="/css/jquery.datetimepicker.css" rel="stylesheet" />
	<script type="text/javascript" src="/js/jquery.js"></script> 
	<script type ="text/javascript" src="/js/jquery.datetimepicker.js"></script>
	</head>
	<body class="zh_CN weui-desktop-page_base ">
		<div class="mp-head" id="header">
			<div id="mp_header" class="weui-desktop-head" style="width:100%;height:80px;position:fixed;top:0;left:0;z-index:9999;">
				<div class="weui-desktop-head__inner">
					<div class="weui-desktop-layout">
						<div class="weui-desktop-layout__side">
							<h1 class="weui-desktop-logo">
								<a href="/" title="帮帮账智能票据中心"></a>
							</h1>
						</div>
						<div id="mp_header_account" class="weui-desktop-layout__extra" style="visibility: visible;">
							<div class="weui-desktop-account">
								<div
									class="weui-desktop-operation-group weui-desktop-account__opr weui-desktop-operation-group_hover weui-desktop-operation_default">
									<span class="weui-desktop-operation-group_default">
										<div class="weui-desktop-account__info">
											<a href="#" class="weui-desktop-account__nickname weui-desktop__small-screen-hide" id="user_company_name"></a>
											<a href="#" class="weui-desktop-account__type weui-desktop__small-screen-hide" id="user_name"></a>
										</div>
									</span>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div id="body" class="mp-body" style="margin-top:80px;min-width:1200px;">
			<div id="js_container_box" class="weui-desktop-layout weui-desktop-layout_global">
				<div id="js_mp_sidemenu" class="weui-desktop-layout__side">
					<ul class="weui-desktop-menu weui-desktop-menu_global" id="menuBar">
						<style>
						.weui-desktop-menu_home>.weui-desktop-menu__link .weui-desktop-menu__name:before
						{
							background:
							url(/img/menu_home.svg)
							no-repeat;
						}
						.weui-desktop-menu_home>.weui-desktop-menu__link_current .weui-desktop-menu__name:before
						{
							background:
							url(/img/menu_home_current.svg)
							no-repeat;
						}
						</style>
						<li class="weui-desktop-menu__item weui-desktop-menu_home">
							<a title="首页" class="weui-desktop-menu__link" href="home.html">
								<span class="weui-desktop-menu__link__inner">
									<span class="weui-desktop-menu__name">首页</span>
								</span>
							</a>
							<ul class="weui-desktop-sub-menu"></ul>
						</li>
						<style>
						.weui-desktop-menu_function>.weui-desktop-menu__link .weui-desktop-menu__name:before
						{
							background:
							url(/img/menu_function.svg)
							no-repeat;
						}
						.weui-desktop-menu_function>.weui-desktop-menu__link_current .weui-desktop-menu__name:before
						{
							background:
							url(/img/menu_function_current.svg)
							no-repeat;
						}
						.ico-load{display:inline-block;width:18px;height:18px;margin:-1px 5px 0 0;*margin-top:3px;line-height:100px;vertical-align:middle;overflow:hidden;}
						.ico-load.white{background:url("/img/loading_18_green.gif") no-repeat;}
						.ico-load.hide{display:none;}
						</style>
						<li class="weui-desktop-menu__item weui-desktop-menu_function">
							<span title="功能" class="weui-desktop-menu__link">
								<span class="weui-desktop-menu__link__inner">
									<span class="weui-desktop-menu__name">功能</span>
								</span>
							</span>
							<ul class="weui-desktop-sub-menu">
								<li class="weui-desktop-sub-menu__item">
								<a title="自动回复" class="weui-desktop-menu__link weui-desktop-menu__link_current " data-id="10006" href="#">
									<span class="weui-desktop-menu__link__inner">
										<span class="weui-desktop-menu__name">发票记录</span>
									</span>
								</a>
								</li>
							</ul>
						</li>
					</ul>
				</div>
				<div id="js_mp_main_content" class="weui-desktop-layout__main">
					<div class="weui-desktop-layout__main__area">
						<div class="weui-desktop-layout__main__inner">
							<div class="weui-desktop-layout__main__hd">
								<h2>发票记录管理</h2>
								<div class="title_tab">
									<ul class="tab_navs title_tab">
										<li class="tab_nav first js_top selected"><a
											href="javascript:;" id="reloadTop">发票列表</a></li>
									</ul>
								</div>
							</div>
							<div class="weui-desktop-layout__main__bd weui-desktop-panel main_bd">
								<div class="global_mod user_global_opr float_layout">
									<div class="global_info">
										<div class="search_bar" id="searchBar">
										<span class="frm_input_box search with_del append " style="padding-right:0px;">
											会计期间:&emsp;<input type="text" value="" id="form_datetime" style="border: 0px;outline:none;cursor: pointer;">
										</span>
										</div>
									</div>
									<div class="global_extra" style="float:right;">
										<a id="export_a" href="javascript:export_loading();" class="btn btn_primary btn_add"><i id="loading_img" class="ico-load white hide"></i>导出凭证Excel</a>
									</div>
									<div class="group_select" style="float:right;margin-top:5px;">
										<label id="isDetail" for="selectAll"
											class="group_select_label frm_checkbox_label"> <i
											class="icon_checkbox" onclick="isDetail(this)"></i><input type="checkbox"
											class="frm_checkbox">是否分明细
										</label>
									</div>
								</div>
								<div class="inner_container_box side_r cell_layout">
									<div class="inner_main">
										<div class="bd">
											<div class="table_wrp user_list">
												<table class="table" cellspacing="0">
													<thead class="thead">
														<tr>
															<th class="table_cell user no_extra" colspan="2">
																<div class="group_select">
																	<label id="selectAll" for="selectAll"
																		class="group_select_label frm_checkbox_label"> <i
																		class="icon_checkbox" onclick="selectAll()"></i> <input type="checkbox"
																		class="frm_checkbox"> 全选
																	</label>
																	<a class="btn btn_default js_tag_putOn_btn" href="javascript:deleteAllSelectedInvoice();">一键删除</a>
																</div>
															</th>
														</tr>
													</thead>
													<tbody class="tbody" id="invoice_list">
													</tbody>
												</table>
												<p class="no_result" id="noresult" style="display: none;">当前会计期间没有数据</p>
											</div>
											<div class="tool_area">
												<div class="pagination_wrp js_pageNavigator">
													<div class="pagination" id="wxPagebar_1532066943311">
														<span class="page_nav_area"> <a
															href="javascript:void(0);" class="btn page_first"
															style="display: none;"></a> <a href="javascript:prePage();"
															class="btn page_prev" style="display: none;"><i
																class="arrow"></i></a> <span class="page_num"> <label id="current_page">0</label>
																<span class="num_gap">/</span><label id="total_page">0</label>
														</span> <a href="javascript:nextPage();" class="btn page_next" style="display: none;"><i
																class="arrow"></i></a> <a href="javascript:void(0);"
															class="btn page_last" style="display: none;"></a>
														</span> <span class="goto_area"> <input type="text" id="skip_page"> <a
															href="javascript:skipPage();" class="btn page_go">跳转</a>
														</span>

													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div id="item_detail" class="dialog_wrp dialog_weapplink_wrp ui-draggable" style="display:none;z-index:999999999;">
			<div class="dialog">
				<div class="dialog_hd">
					<h3>发票详情</h3>
					<button onclick="javascript:closedlg();"
						class="weui-desktop-icon-btn weui-desktop-dialog__close-btn pop_closed">
						<svg width="18" height="18" viewBox="0 0 18 18"
							xmlns="http://www.w3.org/2000/svg">
							<title>关闭</title><path
								d="M10.01 8.996l7.922-7.922c.086-.086.085-.21.008-.289l-.73-.73c-.075-.074-.208-.075-.29.007L9 7.984 1.077.062C.995-.02.863-.019.788.055l-.73.73c-.078.078-.079.203.007.29l7.922 7.92-7.922 7.922c-.086.086-.085.212-.007.29l.73.73c.075.074.207.074.29-.008l7.92-7.921 7.922 7.921c.082.082.215.082.29.008l.73-.73c.077-.078.078-.204-.008-.29l-7.921-7.921z"></path></svg>
					</button>
				</div>
				<div class="dialog_bd ">
					<div class="processor_bar_wrp js_process">
						<ul class="weui-desktop-steps">
						</ul>
					</div>
					<div id="detail_h" style="padding:20px 20px;overflow-y:scroll; color:#6c6c6c;font-size:10px;">
						<div style="height:60px;">
							<div style="width:50%;float:left;">
								<p id="buy_name"></p>
								<p id="buy_code"></p>
								<p id="buy_address"></p>
								<p id="buy_bank"></p>
							</div>
							<div style="width:50%;float:right;text-align:right;">
								<p id="supply_name"></p>
								<p id="supply_code"></p>
								<p id="supply_address"></p>
								<p id="supply_bank"></p>
							</div>
						</div>
						<div>
							<table style="width:100%;text-align:center;margin-top:20px;" border="1" id="invoice_detail">
							</table>
						</div>
						<div style="height:60px;margin-top:20px;">
							<div style="width:50%;float:left;">
								<p id="fpdm"></p>
								<p id="fphm"></p>
							</div>
							<div style="width:50%;float:left;text-align:right;">
								<p id="kprq"></p>
								<p id="create_time"></p>
							</div>
						</div>
					</div>
				</div>

			</div>
		</div>
		<div id="confirm_dlg" class="dialog_wrp dialog_weapplink_wrp ui-draggable" style="display:none;z-index:999999999;">
			<div class="dialog">
				<div class="dialog_hd">
					<h3>提示信息</h3>
					<button onclick="javascript:closedlg();"
						class="weui-desktop-icon-btn weui-desktop-dialog__close-btn pop_closed">
						<svg width="18" height="18" viewBox="0 0 18 18"
							xmlns="http://www.w3.org/2000/svg">
							<title>关闭</title><path
								d="M10.01 8.996l7.922-7.922c.086-.086.085-.21.008-.289l-.73-.73c-.075-.074-.208-.075-.29.007L9 7.984 1.077.062C.995-.02.863-.019.788.055l-.73.73c-.078.078-.079.203.007.29l7.922 7.92-7.922 7.922c-.086.086-.085.212-.007.29l.73.73c.075.074.207.074.29-.008l7.92-7.921 7.922 7.921c.082.082.215.082.29.008l.73-.73c.077-.078.078-.204-.008-.29l-7.921-7.921z"></path></svg>
					</button>
				</div>
				<div class="dialog_bd ">
					<div class="processor_bar_wrp js_process">
						<ul class="weui-desktop-steps">
						</ul>
					</div>
					<div id="detail_h" style="padding:20px 20px;color:#6c6c6c;font-size:20px;">
						<div style="height:60px;">
							<p id="dlg_tip"></p>
						</div>
					</div>
					<div class="processor_bar_wrp js_process">
						<ul class="weui-desktop-steps">
						</ul>
					</div>
					<div id="detail_h" style="padding:20px 20px;color:#6c6c6c;font-size:10px;">
						<div style="height:30px;">
							<div style="width:50%;float:left;" id="confirm_dlg_confirm">
								<a href="javascript:deleteInvoiceConfirm();" class="user_opr btn remark">确定</a>
							</div>
							<div style="width:50%;float:right;text-align:right;" id="confirm_dlg_cancel">
								<a href="javascript:closedlgForBtn();" class="btn btn_primary btn_add">取消</a>
							</div>
						</div>
					</div>
				</div>

			</div>
		</div>
		<div id="dlg_mask" class="mask ui-draggable" style="z-index:99999999;display:none;">
			<iframe frameborder="0" style="filter:progid:DXImageTransform.Microsoft.Alpha(opacity:0);position:absolute;top:0px;left:0px;width:100%;height:100%;" src="about:blank">
			</iframe>
		</div>
	</body>
	<script>
		var is_detail = 0;
	    var bill_date = "";
	    var curDate = new Date();
	    var month = (curDate.getMonth() + 1);
	    bill_date = curDate.getFullYear() + "-" + (month<10?"0"+month:month);
	    console.log(bill_date);
		var current_page = 1;
		var count_pre_page = 5;
		var total_page = 1;
		var deleteInvoiceIds = {}; 
		var currentDelInvoiceId = "";
		$('#form_datetime').datetimepicker({
			minView: "month",
			CustomFormat: "Y-m",
            changeMonth: true,
            changeYear: true,
            timepicker:false,
            autoclose: true,
            value: new Date(),
            Format: 'Custom',
            onSelectDate: function(current_time,$input){
            	var month = (current_time.getMonth() + 1);
            	bill_date = current_time.getFullYear() + "-" + (month<10?"0"+month:month);
            	current_page = 1;
            	getAllInvoice();
            }
		});
		$.datetimepicker.setLocale('ch');
		function displayEmptyContent(){
			$("#buy_name").html("购买方名称:&emsp;&emsp;");
			$("#buy_code").html("纳税人识别号:&emsp;");
			$("#buy_address").html("地址电话:&emsp;&emsp;&emsp;");
			$("#buy_bank").html("开户行及账号:&emsp;");
			$("#supply_name").html("销售方名称:&emsp;&emsp;");
			$("#supply_code").html("纳税人识别号:&emsp;");
			$("#supply_address").html("地址电话:&emsp;&emsp;&emsp;");
			$("#supply_bank").html("开户行及账号:&emsp;");
			$("#fpdm").html("发票代码:&emsp;");
			$("#fphm").html("发票号码:&emsp;");
			$("#kprq").html("开票日期:&emsp;");
			$("#create_time").html("上传时间:&emsp;");
			$("#invoice_detail").html("");
		}
		function displayInvoiceDetailContent(data){
			var invoiceInfo = data.invoice_info;
			var invoiceItemInfo = data.invoice_item_info;
			$("#buy_name").html("购买方名称:&emsp;&emsp;"+invoiceInfo.buy_name);
			$("#buy_code").html("纳税人识别号:&emsp;"+invoiceInfo.buy_identify_code);
			$("#buy_address").html("地址电话:&emsp;&emsp;&emsp;"+invoiceInfo.buy_address);
			$("#buy_bank").html("开户行及账号:&emsp;"+invoiceInfo.buy_deposit_bank);
			$("#supply_name").html("销售方名称:&emsp;&emsp;"+invoiceInfo.supply_name);
			$("#supply_code").html("纳税人识别号:&emsp;"+invoiceInfo.supply_identify_code);
			$("#supply_address").html("地址电话:&emsp;&emsp;&emsp;"+invoiceInfo.supply_address);
			$("#supply_bank").html("开户行及账号:&emsp;"+invoiceInfo.supply_deposit_bank);
			$("#fpdm").html("发票代码:&emsp;"+invoiceInfo.fpdm);
			$("#fphm").html("发票号码:&emsp;"+invoiceInfo.fphm);
			$("#kprq").html("开票日期:&emsp;"+invoiceInfo.kprq + " 00:00:00");
			$("#create_time").html("上传时间:&emsp;"+invoiceInfo.create_time_readable);
			var itemString = "<tr><th>货物或应税劳务、服务名称</th><th>规格型号</th><th>单位</th><th>数量</th><th>单价</th><th>金额</th><th>税率</th><th>税额</th></tr>";
			for(var index in invoiceItemInfo){
				itemString = itemString + "<tr><td>"+invoiceItemInfo[index].abstract_info+"</td><td>"+invoiceItemInfo[index].model+"</td><td>"+invoiceItemInfo[index].unit+"</td><td>"+invoiceItemInfo[index].count+"</td><td>"+invoiceItemInfo[index].unit_price+"</td><td>"+invoiceItemInfo[index].amount+"</td><td>"+invoiceItemInfo[index].tax_rate+"%</td><td>"+invoiceItemInfo[index].tax+"</td></tr>";
			}
			$("#invoice_detail").html(itemString);
		}
		function opendlg(invoiceId, status){
			if(status != 1){
				$("#confirm_dlg_cancel").hide();
				$("#confirm_dlg_confirm").hide();
				var width = document.documentElement.clientWidth;
				var height = document.documentElement.clientHeight;
				document.getElementById("confirm_dlg").style.width = "600px";
				document.getElementById("confirm_dlg").style.height = (height * 2 / 3) + "px";
				document.getElementById("confirm_dlg").style.top = (height/2 - (height/3)) + "px";
				document.getElementById("confirm_dlg").style.left = (width/2 - 300) + "px";
				document.getElementById("dlg_mask").style.display = "";
				document.getElementById("confirm_dlg").style.display = "";
				$("#dlg_tip").html("当前发票正在识别或识别失败，无法查看详细信息！");
				return;
			}
			var width = document.documentElement.clientWidth;
			var height = document.documentElement.clientHeight;
			document.getElementById("item_detail").style.width = "600px";
			document.getElementById("item_detail").style.height = (height * 2 / 3) + "px";
			document.getElementById("item_detail").style.top = (height/2 - (height/3)) + "px";
			document.getElementById("item_detail").style.left = (width/2 - 300) + "px";
			document.getElementById("detail_h").style.maxHeight = (height *2 / 3 -80) + "px";
			document.getElementById("dlg_mask").style.display = "";
			document.getElementById("item_detail").style.display = "";
			displayEmptyContent();
			$.ajax({
				url: '/admin/getInvoiceDetailByIdForWeb',
				type: "POST",
				data: {
					invoice_id:invoiceId
				},
				success: function(data) {
					displayInvoiceDetailContent(data);
				}
			});
		}
		function closedlg(){
			document.getElementById("dlg_mask").style.display = "none";
			document.getElementById("item_detail").style.display = "none";
			document.getElementById("confirm_dlg").style.display = "none";
			$("#confirm_dlg_cancel").show();
			$("#confirm_dlg_confirm").show();
			$("#dlg_tip").html("");
		}
		function closedlgForBtn(){
			currentDelInvoiceId = "";
			$("#confirm_dlg_cancel").show();
			$("#confirm_dlg_confirm").show();
			closedlg();
		}
		function export_loading(){
			if(total_page == 0){
				$("#confirm_dlg_cancel").hide();
				$("#confirm_dlg_confirm").hide();
				var width = document.documentElement.clientWidth;
				var height = document.documentElement.clientHeight;
				document.getElementById("confirm_dlg").style.width = "600px";
				document.getElementById("confirm_dlg").style.height = (height * 2 / 3) + "px";
				document.getElementById("confirm_dlg").style.top = (height/2 - (height/3)) + "px";
				document.getElementById("confirm_dlg").style.left = (width/2 - 300) + "px";
				document.getElementById("dlg_mask").style.display = "";
				document.getElementById("confirm_dlg").style.display = "";
				$("#dlg_tip").html("当前会计期间没有票据，无法生成凭证！");
				return;
			}
			$("#export_a").attr('href', 'javascript:;');
			$("#loading_img").removeClass("hide");
			$.ajax({
				url: '/admin/downloadVoucherPath',
				type: "POST",
				data: {
					bill_date:bill_date,
					is_detail:is_detail,
				},
				success: function(data) {
					$("#loading_img").addClass("hide");
					$("#export_a").attr('href', 'javascript:export_loading();');
					if(data.error_code != "000000"){
						$("#confirm_dlg_cancel").hide();
						$("#confirm_dlg_confirm").hide();
						var width = document.documentElement.clientWidth;
						var height = document.documentElement.clientHeight;
						document.getElementById("confirm_dlg").style.width = "600px";
						document.getElementById("confirm_dlg").style.height = (height * 2 / 3) + "px";
						document.getElementById("confirm_dlg").style.top = (height/2 - (height/3)) + "px";
						document.getElementById("confirm_dlg").style.left = (width/2 - 300) + "px";
						document.getElementById("dlg_mask").style.display = "";
						document.getElementById("confirm_dlg").style.display = "";
						$("#dlg_tip").html("生成凭证出错，请稍后重试！");
					} else {
						$('<form action="/admin/downloadVoucher" method="post">' +
				                '<input type="text" name="bill_date" value="'+bill_date+'"/>' +
				                '<input type="text" name="excel_path" value="'+data.xls_path+'"/>' +
				            '</form>')
				    	.appendTo('body').submit().remove();
					}
				}
			});
		}
		function openConfirmDlg(){
			var width = document.documentElement.clientWidth;
			var height = document.documentElement.clientHeight;rr
			document.getElementById("confirm_dlg").style.width = "600px";
			document.getElementById("confirm_dlg").style.height = (height * 2 / 3) + "px";
			document.getElementById("confirm_dlg").style.top = (height/2 - (height/3)) + "px";
			document.getElementById("confirm_dlg").style.left = (width/2 - 300) + "px";
			document.getElementById("dlg_mask").style.display = "";
			document.getElementById("confirm_dlg").style.display = "";
		}
		function getAllInvoice(){
			$("#invoice_list").html("");
			$.ajax({
				url: '/admin/getAllInvoiceForWeb',
				type: "POST",
				data: {
					bill_date:bill_date,
					current_page:current_page,
					count_pre_page:count_pre_page,
				},
				success: function(data) {
					var listString = "";
					if(data.total == 0) {
						$("#noresult").show();
						$("#current_page").html("0");
						$("#total_page").html("0");
						total_page = 0;
					} else {
						$("#noresult").hide();
						for(var index in data.data){
							listString = listString + "<tr><td class='table_cell user'><div class='user_info'><label invoice_id='"+data.data[index].id+"' for='checkoSTV_t5y7_cldzQr0gjIAQn7d-aA'class='frm_checkbox_label'><i class='icon_checkbox'></i><input style='display:none;' class='frm_checkbox js_select' type='checkbox' value='oSTV_t5y7_cldzQr0gjIAQn7d-aA' id='checkoSTV_t5y7_cldzQr0gjIAQn7d-aA'></label><a href='javascript:opendlg("+data.data[index].id+","+data.data[index].rec_status+");'><span class='remark_name'>供应方名称:"+data.data[index].supply_name+"</span><span class='avatar'><img src='/img/invoice01.jpg' data-id='oSTV_t4DEXmGjf7lJbFQ2xfMDDZQ' class='js_msgSenderAvatar'></span><div class='js_tags user_tag_area'><span class='js_tags_list user_tag_list'>合计金额:&emsp;"+data.data[index].amount+"元</span></div><div class='js_tags user_tag_area'><span class='js_tags_list user_tag_list'>合计税额:&emsp;"+data.data[index].tax+"元</span></div><div class='js_tags user_tag_area'><span class='js_tags_list user_tag_list' style='width:50%;float:left;'>开票日期:&emsp;"+data.data[index].kprq.substring(0,4)+"年"+data.data[index].kprq.substring(4,2)+"月"+data.data[index].kprq.substring(6,2)+"日</span><span class='js_tags_list user_tag_list' style='width:50%;float:right;color:#"+(data.data[index].rec_status==0?"7d7dff":(data.data[index].rec_status==1?"2f9833":"ff5809"))+";'>识别状态:&emsp;"+(data.data[index].rec_status==0?"正在识别":(data.data[index].rec_status==1?"识别成功":"识别失败"))+"</span></div></a></div></td><td class='table_cell user_opr tr' style='text-align:right;'><a href='javascript:deleteInvoiceForSingle("+data.data[index].id+");' class='btn remark js_msgSenderRemark' data-fakeid='oSTV_t9-tNksUT_78czxDstmXXNc'>删除</a></td></tr>";
						}
						$("#invoice_list").html(listString);
						$("#current_page").html(1);
						total_page = Math.ceil(data.total/count_pre_page);
						$("#total_page").html(total_page);
						if(current_page < total_page) $(".btn.page_next").show();
						bindCheckEvent();
					}
				}
			});
		}
		function skipPage(){
			var skipPage = parseInt($("#skip_page").val()==""?0:$("#skip_page").val());
			if(skipPage<1 || skipPage>total_page) {
				$("#confirm_dlg_cancel").hide();
				$("#confirm_dlg_confirm").hide();
				var width = document.documentElement.clientWidth;
				var height = document.documentElement.clientHeight;
				document.getElementById("confirm_dlg").style.width = "600px";
				document.getElementById("confirm_dlg").style.height = (height * 2 / 3) + "px";
				document.getElementById("confirm_dlg").style.top = (height/2 - (height/3)) + "px";
				document.getElementById("confirm_dlg").style.left = (width/2 - 300) + "px";
				document.getElementById("dlg_mask").style.display = "";
				document.getElementById("confirm_dlg").style.display = "";
				$("#dlg_tip").html("当前页码范围不正确，请输入正确的页码！");
				return;
			}
			current_page = skipPage
			if(current_page == 1) {
				$(".btn.page_prev").hide();
			} else {
				$(".btn.page_prev").show();
			}
			if(current_page < total_page) $(".btn.page_next").show();
			$.ajax({
				url: '/admin/getAllInvoiceForWeb',
				type: "POST",
				data: {
					bill_date:bill_date,
					current_page:current_page,
					count_pre_page:count_pre_page,
				},
				success: function(data) {
					var listString = "";
					if(data.total == 0) {
					} else {
						for(var index in data.data){
							listString = listString + "<tr><td class='table_cell user'><div class='user_info'><label invoice_id='"+data.data[index].id+"' for='checkoSTV_t5y7_cldzQr0gjIAQn7d-aA'class='frm_checkbox_label'><i class='icon_checkbox'></i><input style='display:none;'  class='frm_checkbox js_select' type='checkbox' value='oSTV_t5y7_cldzQr0gjIAQn7d-aA' id='checkoSTV_t5y7_cldzQr0gjIAQn7d-aA'></label><a href='javascript:opendlg("+data.data[index].id+","+data.data[index].rec_status+");'><span class='remark_name'>供应方名称:"+data.data[index].supply_name+"</span><span class='avatar'><img src='/img/invoice01.jpg' data-id='oSTV_t4DEXmGjf7lJbFQ2xfMDDZQ' class='js_msgSenderAvatar'></span><div class='js_tags user_tag_area'><span class='js_tags_list user_tag_list'>合计金额:&emsp;"+data.data[index].amount+"元</span></div><div class='js_tags user_tag_area'><span class='js_tags_list user_tag_list'>合计税额:&emsp;"+data.data[index].tax+"元</span></div><div class='js_tags user_tag_area'><span class='js_tags_list user_tag_list' style='width:50%;float:left;'>开票日期:&emsp;"+data.data[index].kprq.substring(0,4)+"年"+data.data[index].kprq.substring(4,2)+"月"+data.data[index].kprq.substring(6,2)+"日</span><span class='js_tags_list user_tag_list' style='width:50%;float:right;color:#"+(data.data[index].rec_status==0?"7d7dff":(data.data[index].rec_status==1?"2f9833":"ff5809"))+";'>识别状态:&emsp;"+(data.data[index].rec_status==0?"正在识别":(data.data[index].rec_status==1?"识别成功":"识别失败"))+"</span></div></a></div></td><td class='table_cell user_opr tr' style='text-align:right;'><a href='javascript:deleteInvoiceForSingle("+data.data[index].id+");' class='btn remark js_msgSenderRemark' data-fakeid='oSTV_t9-tNksUT_78czxDstmXXNc'>删除</a></td></tr>";
						}
						$("#invoice_list").html(listString);
						$("#current_page").html(current_page);
						$("#total_page").html(total_page);
						bindCheckEvent();
					}
				}
			});
		}
		function prePage(){
			$("#skip_page").val("");
			current_page--;
			if(current_page == 1) $(".btn.page_prev").hide();
			if(current_page < total_page) $(".btn.page_next").show();
			$.ajax({
				url: '/admin/getAllInvoiceForWeb',
				type: "POST",
				data: {
					bill_date:bill_date,
					current_page:current_page,
					count_pre_page:count_pre_page,
				},
				success: function(data) {
					var listString = "";
					if(data.total == 0) {
					} else {
						for(var index in data.data){
							listString = listString + "<tr><td class='table_cell user'><div class='user_info'><label invoice_id='"+data.data[index].id+"' for='checkoSTV_t5y7_cldzQr0gjIAQn7d-aA'class='frm_checkbox_label'><i class='icon_checkbox'></i><input style='display:none;'  class='frm_checkbox js_select' type='checkbox' value='oSTV_t5y7_cldzQr0gjIAQn7d-aA' id='checkoSTV_t5y7_cldzQr0gjIAQn7d-aA'></label><a href='javascript:opendlg("+data.data[index].id+","+data.data[index].rec_status+");'><span class='remark_name'>供应方名称:"+data.data[index].supply_name+"</span><span class='avatar'><img src='/img/invoice01.jpg' data-id='oSTV_t4DEXmGjf7lJbFQ2xfMDDZQ' class='js_msgSenderAvatar'></span><div class='js_tags user_tag_area'><span class='js_tags_list user_tag_list'>合计金额:&emsp;"+data.data[index].amount+"元</span></div><div class='js_tags user_tag_area'><span class='js_tags_list user_tag_list'>合计税额:&emsp;"+data.data[index].tax+"元</span></div><div class='js_tags user_tag_area'><span class='js_tags_list user_tag_list' style='width:50%;float:left;'>开票日期:&emsp;"+data.data[index].kprq.substring(0,4)+"年"+data.data[index].kprq.substring(4,2)+"月"+data.data[index].kprq.substring(6,2)+"日</span><span class='js_tags_list user_tag_list' style='width:50%;float:right;color:#"+(data.data[index].rec_status==0?"7d7dff":(data.data[index].rec_status==1?"2f9833":"ff5809"))+";'>识别状态:&emsp;"+(data.data[index].rec_status==0?"正在识别":(data.data[index].rec_status==1?"识别成功":"识别失败"))+"</span></div></a></div></td><td class='table_cell user_opr tr' style='text-align:right;'><a href='javascript:deleteInvoiceForSingle("+data.data[index].id+");' class='btn remark js_msgSenderRemark' data-fakeid='oSTV_t9-tNksUT_78czxDstmXXNc'>删除</a></td></tr>";
						}
						$("#invoice_list").html(listString);
						$("#current_page").html(current_page);
						$("#total_page").html(total_page);
						bindCheckEvent();
					}
				}
			});
		}
		function nextPage(){
			$("#skip_page").val("");
			current_page++;
			if(current_page == total_page) $(".btn.page_next").hide();
			if(current_page > 1) $(".btn.page_prev").show();
			$.ajax({
				url: '/admin/getAllInvoiceForWeb',
				type: "POST",
				data: {
					bill_date:bill_date,
					current_page:current_page,
					count_pre_page:count_pre_page,
				},
				success: function(data) {
					var listString = "";
					if(data.total == 0) {
					} else {
						for(var index in data.data){
							listString = listString + "<tr><td class='table_cell user'><div class='user_info'><label invoice_id='"+data.data[index].id+"' for='checkoSTV_t5y7_cldzQr0gjIAQn7d-aA'class='frm_checkbox_label'><i class='icon_checkbox'></i><input style='display:none;'  class='frm_checkbox js_select' type='checkbox' value='oSTV_t5y7_cldzQr0gjIAQn7d-aA' id='checkoSTV_t5y7_cldzQr0gjIAQn7d-aA'></label><a href='javascript:opendlg("+data.data[index].id+","+data.data[index].rec_status+");'><span class='remark_name'>供应方名称:"+data.data[index].supply_name+"</span><span class='avatar'><img src='/img/invoice01.jpg' data-id='oSTV_t4DEXmGjf7lJbFQ2xfMDDZQ' class='js_msgSenderAvatar'></span><div class='js_tags user_tag_area'><span class='js_tags_list user_tag_list'>合计金额:&emsp;"+data.data[index].amount+"元</span></div><div class='js_tags user_tag_area'><span class='js_tags_list user_tag_list'>合计税额:&emsp;"+data.data[index].tax+"元</span></div><div class='js_tags user_tag_area'><span class='js_tags_list user_tag_list' style='width:50%;float:left;'>开票日期:&emsp;"+data.data[index].kprq.substring(0,4)+"年"+data.data[index].kprq.substring(4,2)+"月"+data.data[index].kprq.substring(6,2)+"日</span><span class='js_tags_list user_tag_list' style='width:50%;float:right;color:#"+(data.data[index].rec_status==0?"7d7dff":(data.data[index].rec_status==1?"2f9833":"ff5809"))+";'>识别状态:&emsp;"+(data.data[index].rec_status==0?"正在识别":(data.data[index].rec_status==1?"识别成功":"识别失败"))+"</span></div></a></div></td><td class='table_cell user_opr tr' style='text-align:right;'><a href='javascript:deleteInvoiceForSingle("+data.data[index].id+");' class='btn remark js_msgSenderRemark' data-fakeid='oSTV_t9-tNksUT_78czxDstmXXNc'>删除</a></td></tr>";
						}
						$("#invoice_list").html(listString);
						$("#current_page").html(current_page);
						$("#total_page").html(total_page);
						bindCheckEvent();
					}
				}
			});
		}
		$.ajax({
			url: '/admin/getUserInfo',
			type: "POST",
			data: {},
			success: function(data) {
				$("#user_company_name").html(data.user_company_name == null?"":data.user_company_name);
				$("#user_name").html(data.user_name == null?"":data.user_name);
				$("#syje").html(data.balance + "元");
				$("#kycs").html(data.balance * 10 + "次");
				$("#total").html(data.total);
				getAllInvoice();
			}
		});
		function selectAll(){
			deleteInvoiceIds = {};
			if($("#selectAll").hasClass("selected")) {
				$("#selectAll").removeClass("selected");
				$("tbody .icon_checkbox").each(function(){
					var node = $(this)[0].parentNode;
					$(node).removeClass("selected");
				});
			} else {
				$("#selectAll").addClass("selected");
				$("tbody .icon_checkbox").each(function(){
					var node = $(this)[0].parentNode;
					$(node).addClass("selected");
					deleteInvoiceIds[$(node).attr("invoice_id")] = "";
				});
			}			
		}
		function bindCheckEvent(){
			$("tbody .icon_checkbox").each(function(){
				$(this).click(function(){
					var node = $(this)[0].parentNode;
					if($(node).hasClass("selected")){
						$(node).removeClass("selected");
						delete deleteInvoiceIds[$(node).attr("invoice_id")];
					} else {
						$(node).addClass("selected");
						deleteInvoiceIds[$(node).attr("invoice_id")] = "";
					}
				});
			});
		}
		function deleteInvoiceForSingle(invoiceId){
			currentDelInvoiceId = invoiceId;
			var width = document.documentElement.clientWidth;
			var height = document.documentElement.clientHeight;
			document.getElementById("confirm_dlg").style.width = "600px";
			document.getElementById("confirm_dlg").style.height = (height * 2 / 3) + "px";
			document.getElementById("confirm_dlg").style.top = (height/2 - (height/3)) + "px";
			document.getElementById("confirm_dlg").style.left = (width/2 - 300) + "px";
			document.getElementById("dlg_mask").style.display = "";
			document.getElementById("confirm_dlg").style.display = "";
			$("#dlg_tip").html("您确定要删除当前指定的发票吗？");
		}
		function deleteInvoiceConfirm(){
			if(currentDelInvoiceId != "") {
				$.ajax({
					url: '/admin/deleteInvoiceForSingle',
					type: "POST",
					data: {
						invoice_id:parseInt(currentDelInvoiceId)
					},
					success: function(data) {
						window.location.reload();
					}
				});
				closedlgForBtn();
			} else {
				var ids = "";
				for(var key in deleteInvoiceIds){
					ids = ids + key + "#";
				}
				$.ajax({
					url: '/admin/deleteInvoiceAll',
					type: "POST",
					data: {
						invoice_id:ids
					},
					success: function(data) {
						window.location.reload();
					}
				});
				closedlgForBtn();
			}
		}
		function deleteAllSelectedInvoice(){
			var hasSelected = false;
			for(var index in deleteInvoiceIds){
				hasSelected = true;
				break;
			}
			if(hasSelected){
				$("#confirm_dlg_cancel").show();
				$("#confirm_dlg_confirm").show();
				var width = document.documentElement.clientWidth;
				var height = document.documentElement.clientHeight;
				document.getElementById("confirm_dlg").style.width = "600px";
				document.getElementById("confirm_dlg").style.height = (height * 2 / 3) + "px";
				document.getElementById("confirm_dlg").style.top = (height/2 - (height/3)) + "px";
				document.getElementById("confirm_dlg").style.left = (width/2 - 300) + "px";
				document.getElementById("dlg_mask").style.display = "";
				document.getElementById("confirm_dlg").style.display = "";
				$("#dlg_tip").html("您确定要删除当前指定的发票吗？");
			} else {
				$("#confirm_dlg_cancel").hide();
				$("#confirm_dlg_confirm").hide();
				var width = document.documentElement.clientWidth;
				var height = document.documentElement.clientHeight;
				document.getElementById("confirm_dlg").style.width = "600px";
				document.getElementById("confirm_dlg").style.height = (height * 2 / 3) + "px";
				document.getElementById("confirm_dlg").style.top = (height/2 - (height/3)) + "px";
				document.getElementById("confirm_dlg").style.left = (width/2 - 300) + "px";
				document.getElementById("dlg_mask").style.display = "";
				document.getElementById("confirm_dlg").style.display = "";
				$("#dlg_tip").html("请先选择需要删除的发票！");
			}
		}
		function isDetail(ele){
			var node = $(ele)[0].parentNode;
			if($(node).hasClass("selected")){
				$(node).removeClass("selected");
				is_detail = 0;
			} else {
				$(node).addClass("selected");
				is_detail = 1;
			}
		}
	</script>
</html>